import{_ as g}from"./index-13654563.js";import{am as w,r as y,o as b,Q as _,a as F,c as v,F as c,G as r,e as d,b as D,d as P,J as M}from"./index-ea8e790e.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./use-id-f89c561d.js";const k={code:200,success:!0,data:"http://192.10.184.54:10002/ocf/data/filename.ocf",msg:"操作成功"},B={code:200,success:!0,data:{link:"http://192.10.50.64:9100/synergy/upload/20240625/77c73c270ccd4b3854d7cd1cdf6ad1b9.dwg",name:"upload/20240625/77c73c270ccd4b3854d7cd1cdf6ad1b9.dwg",hash:"-782858495",length:355190,putTime:"2024-06-25 09:24:09",contentType:"application/octet-stream"},msg:"操作成功"},S={id:"webcad",style:{width:"100%",height:"100%","background-color":"#cea8a8"}},T={__name:"dwg",setup(q){const l=w();let{filePath:i}=l.query,o=y(!1),e="";const u=()=>{const a={save:[],measures:["measureCoordinate"],notes:["noteOval"]};try{e=new window.GStarSDK({wrapId:"webcad",language:"zh",toolbarHideItems:a,isHideMarks:!0,apiHost:window.location.protocol+"//"+window.location.host})}catch{}e.enableZoom(5),e.enablePan(1),e.disableMap(),e.measures.accuracy=3,e.apiRename.saveAs="/saveAsdwg?key=5427&cad=test",e.apiRename.saveAsPdf="/saveAsPdf?key=5427&cad=test";const s="fldXImCGIwhP8ZQO4qecFY4ir2JxCc8bQUQ1ORrusA70H26qenVFScQPm3tMVFJ5";e.setDynamicPW(s)},f=(a,s)=>{const t=new XMLHttpRequest;t.open("GET",a,!0),t.responseType="arraybuffer",t.send(null),t.addEventListener("progress",function(n){n.lengthComputable&&e.Tips.showProgress(0,"下载中  "+(n.loaded/1048576).toFixed(1)+"M/"+(n.total/1048576).toFixed(1)+"M")},!1),t.onload=function(){s(t.response)}},p=a=>{new FormData().append("url",a);const{success:t,data:n}=k;t?f(n,async x=>{const h=await(await fetch("/static/file/dwg/filename.ocf")).arrayBuffer();await e.render("ocf",h,"111",!0)}):o.value=!0},m=a=>{if(!a){o.value=!0;return}const{success:s,data:t}=B;s?(u(),p(t.link)):o.value=!0};return b(()=>{document.body.style.height="100%",m(i)}),_(()=>{e&&e.destroy(),e=null,document.body.style.height="auto"}),(a,s)=>{const t=g;return F(),v(M,null,[c(D("div",S,null,512),[[r,!d(o)]]),c(P(t,{description:"资源加载失败,请返回重试"},null,512),[[r,d(o)]])],64)}}};export{T as default};
